### 项目介绍

> 由惠而信产品图册改变而来，作为电子图册供客户浏览使用，客户第一次登陆需要填写表单，后续登录不用。

### 技术链

> vant-ui + wx.cloud.Fn + mongodb + cdn

后续可能改用为七牛云cdn和云存储

### 项目功能页

- craousel：主要功能：图片全屏轮播和图片栏目跳转，用户手势缩放图片

- collect： 主要功能：调用云函数sendSms实现发送sms验证码，验证表单并插入数据库

### 数据库

- sms-record： 用以记录发送的sms请求信息

- users： 用以记录客户来访的信息

### 几个主要功能点

1. 图片缩放

> 由于图片本身像素的因素，需要缩放以看大图，不允许客户下载。

做法：

一开始的解决方法是调用微信的图片预览api `wx.preview()`， 存在问题：图片缩放解决了，但弹出的预览窗口允许下载图片。

后续选择自己做一个图片预览节点，通过点击图片插入页面，基本解决大致需求。美中不足：点击和缩放手势冲突，需要自行解决最大最小缩放比例等缩放因素。后续取消`bindtap`事件，选择在`touchstart`中进行判断是点击还是长按，作为第一版功能解决方案，第二版通过使用微信新出组件 `<move-area>`,更完美的解决功能点

总结：对小程序API包括框架组件不熟悉，在选用技术上踩坑了。

2. 图片轮播 + 懒加载

> 图片本身数据较大，一次性加载完对cdn负荷太大。月免费cdn只有5G

做法：

选用小程序轮播组件`<swiper>` + `wx.createIntersectionObserver()` 实现轮播到底部20像素加载图片

踩坑：

通过计算高度去控制图片是否显示， 在`onPageScroll()`上计算滚动高度并显示对应图片

3. 侧边栏 + 栏目跳转

> 点击侧边栏对应菜单跳转到对应页数

做法： 

touchstart 和 touchend 判断手势，右滑弹出侧边栏，点击改变data属性里面的currentID去实现轮播翻页